services:
  test-integration-ltngdb-engine:
    container_name: "test-integration-ltngdb-engine"
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    environment:
      LTNG_DB_SERVER_NETWORK: tcp
      LTNG_DB_SERVER_PORT: "50050"
      LTNG_DB_ENGINE: "LIGHTNING_ENGINE_V2"
      LTNG_DB_UI_ADDR: "7070"
      GOMAXPROCS: 2048
    ports:
      - "50050:50050"
      - "7001:7001" # pprof port
      - "7070:7070"
    volumes:
      - ../../.ltngdb-docker-ltngdb-engine:/var/lib/lightning-db-node/data

  test-integration-badgerdb-engine:
    container_name: "test-integration-badgerdb-engine"
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    environment:
      LTNG_DB_SERVER_NETWORK: tcp
      LTNG_DB_SERVER_PORT: "50051"
      LTNG_DB_ENGINE: "BADGER_DB_ENGINE_V4"
      LTNG_DB_UI_ADDR: "7071"
    ports:
      - "50051:50051"
      - "7002:7001" # pprof port (mapped to different host port to avoid conflict)
      - "7071:7071"
    volumes:
      - ../../.ltngdb-docker-badgerdb-engine:/var/lib/lightning-db-node/data
