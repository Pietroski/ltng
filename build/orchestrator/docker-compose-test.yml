services:
  test-integration-ltngdb-engine:
    container_name: 'test-integration-ltngdb-engine'
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    privileged: true
    environment:
      LTNG_SERVER_NETWORK: tcp
      LTNG_SERVER_PORT: "50050"
      LTNG_ENGINE: "LIGHTNING_ENGINE_V2"
      LTNG_UI_ADDR: "8080"
    ports:
      - '50050:50050'
      - '7001:7001'  # pprof port
      - '8080:8080'
    volumes:
      - ../../.ltngdb-docker-ltngdb-engine:/var/lib/lightning-db-node/data

  test-integration-badgerdb-engine:
    container_name: 'test-integration-badgerdb-engine'
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    environment:
      LTNG_SERVER_NETWORK: tcp
      LTNG_SERVER_PORT: "50051"
      LTNG_ENGINE: "BADGER_DB_ENGINE_V4"
      LTNG_UI_ADDR: "8081"
    ports:
      - '50051:50051'
      - '7002:7001'  # pprof port (mapped to different host port to avoid conflict)
      - '8081:8081'
    volumes:
      - ../../.ltngdb-docker-badgerdb-engine:/var/lib/lightning-db-node/data
