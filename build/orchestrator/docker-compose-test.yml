services:
  test-integration-ltngdb-engine:
    container_name: 'test-integration-ltngdb-engine'
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    environment:
      LTNG_SERVER_NETWORK: tcp
      LTNG_SERVER_PORT: "50050"
      LTNG_ENGINE: "LIGHTNING_ENGINE_V2"
    ports:
      - '50050:50050'
      - '7001:7001'  # pprof port
    volumes:
      - test-integration-ltngdb-engine-volume:/var/lib/lightning-db-node/data

  test-integration-badgerdb-engine:
    container_name: 'test-integration-badgerdb-engine'
    build:
      context: ../..
      dockerfile: build/docker/lightning-db-node.Dockerfile
    restart: always
    environment:
      LTNG_SERVER_NETWORK: tcp
      LTNG_SERVER_PORT: "50051"
      LTNG_ENGINE: "BADGER_DB_ENGINE_V4"
    ports:
      - '50051:50051'
      - '7002:7001'  # pprof port (mapped to different host port to avoid conflict)
    volumes:
      - test-integration-badgerdb-engine-volume:/var/lib/lightning-db-node/data

volumes:
  test-integration-ltngdb-engine-volume:
    driver: local
  test-integration-badgerdb-engine-volume:
    driver: local
